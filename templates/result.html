{% extends "base.html" %}

{% block title %}K·∫øt qu·∫£ ph√¢n t√≠ch - Dental AI{% endblock %}

{% block content %}
<div class="container">
            <!-- Result Header -->
            <div class="result-header">
                <h1>K·∫øt qu·∫£ ph√¢n t√≠ch</h1>
                <p>Ph√¢n t√≠ch b·∫±ng CBAM Ensemble Model</p>
            </div>

            <!-- Result Grid -->
            <div class="result-grid">
                <!-- Image Section -->
                <div class="result-image-card">
                    <h3>·∫¢nh X-quang</h3>
                    <img src="{{ url_for('static', filename='uploads/' + filename) }}" alt="X-Ray">
                </div>

                <!-- Diagnosis Section -->
                <div class="result-diagnosis-card">
                    <h3>Ch·∫©n ƒëo√°n</h3>
                    
                    <div class="diagnosis-result {{ prediction.lower()[:3] }}">
                        <div class="diagnosis-badge">
                            <span class="badge-icon">
                                {% if prediction == 'S√¢u rƒÉng' %}ü¶∑
                                {% elif prediction == 'G√£y rƒÉng' %}‚ö†Ô∏è
                                {% else %}‚úì{% endif %}
                            </span>
                            <div>
                                <div class="badge-title">{{ prediction }}</div>
                                <div class="badge-confidence">ƒê·ªô tin c·∫≠y: {{ confidence }}%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Severity Level Section (NEW) -->
                    {% if severity_level %}
                    <div class="severity-section">
                        <h4>M·ª©c ƒë·ªô nghi√™m tr·ªçng</h4>
                        <div class="severity-badge {{ medical_advice.urgency_color }}">
                            <span class="severity-icon">{{ medical_advice.icon }}</span>
                            <div class="severity-info">
                                <div class="severity-level">{{ severity_level }}</div>
                                <div class="severity-urgency">{{ medical_advice.urgency }}</div>
                            </div>
                        </div>
                        
                        <!-- Severity Score Bar -->
                        <div class="severity-score-bar">
                            <div class="score-label">ƒêi·ªÉm ƒë√°nh gi√°: {{ severity_score }}/100</div>
                            <div class="score-bar-wrap">
                                <div class="score-bar-fill {{ medical_advice.urgency_color }}" 
                                     style="width: {{ severity_score }}%"></div>
                            </div>
                            <div class="score-markers">
                                <span class="marker" style="left: 35%">Nh·∫π</span>
                                <span class="marker" style="left: 65%">Trung b√¨nh</span>
                                <span class="marker" style="right: 5%">N·∫∑ng</span>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <div class="probability-section">
                        <h4>Ph√¢n b·ªë x√°c su·∫•t</h4>
                        {% for class_name, prob in probabilities.items() %}
                            <div class="prob-row">
                                <span class="prob-name">{{ class_name }}</span>
                                <div class="prob-bar-wrap">
                                    <div class="prob-bar-fill" style="width: {{ prob }}%"></div>
                                </div>
                                <span class="prob-percent">{{ "%.1f"|format(prob) }}%</span>
                            </div>
                        {% endfor %}
                    </div>

                    <!-- Medical Advice Section (UPDATED) -->
                    <div class="medical-advice-section">
                        <div class="advice-header">
                            <div class="advice-icon">{{ medical_advice.icon }}</div>
                            <h4>{{ medical_advice.title }}</h4>
                        </div>
                        
                        <div class="advice-description">
                            <p>{{ medical_advice.description }}</p>
                        </div>

                        {% if medical_advice.symptoms %}
                        <div class="advice-block">
                            <h5>ü©∫ Tri·ªáu ch·ª©ng</h5>
                            <ul>
                                {% for symptom in medical_advice.symptoms %}
                                <li>{{ symptom }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}

                        {% if medical_advice.risks %}
                        <div class="advice-block risks">
                            <h5>‚ö†Ô∏è Nguy c∆° n·∫øu kh√¥ng ƒëi·ªÅu tr·ªã</h5>
                            <ul>
                                {% for risk in medical_advice.risks %}
                                <li>{{ risk }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}

                        <div class="advice-block recommendations">
                            <h5>üíä Khuy·∫øn ngh·ªã ƒëi·ªÅu tr·ªã</h5>
                            <ul>
                                {% for recommendation in medical_advice.recommendations %}
                                <li>{{ recommendation }}</li>
                                {% endfor %}
                            </ul>
                        </div>

                        <div class="disclaimer">
                            <p>‚ö†Ô∏è <strong>L∆∞u √Ω quan tr·ªçng:</strong> K·∫øt qu·∫£ ph√¢n t√≠ch n√†y ch·ªâ mang t√≠nh tham kh·∫£o v√† ƒë∆∞·ª£c t·∫°o ra b·ªüi h·ªá th·ªëng AI. Vui l√≤ng ƒë·∫øn g·∫∑p nha sƒ© chuy√™n nghi·ªáp ƒë·ªÉ ƒë∆∞·ª£c kh√°m, ch·∫©n ƒëo√°n v√† ƒëi·ªÅu tr·ªã ch√≠nh x√°c.</p>
                        </div>
                    </div>

                    <div class="result-actions">
                        <a href="{{ url_for('index') }}" class="btn btn-primary">
                            <span>‚Üª</span> Ph√¢n t√≠ch ·∫£nh kh√°c
                        </a>
                        <button onclick="window.print()" class="btn btn-secondary">
                            <span>üñ®</span> In k·∫øt qu·∫£
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
